---
import { getLangFromUrl } from "../utils/i18n";

const { placeholder = "Buscar palabra...", query = "" } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const prefix = lang === "en" ? "/en" : "/es";
const action = `${prefix}/buscar`;
---

<form
  class="bg-card border-theme shadow-theme-sm flex items-center gap-2.5 rounded-lg border p-1 transition-all duration-200 sm:p-2"
  action={action}
  method="get"
>
  <input
    type="search"
    name="q"
    value={query}
    placeholder={placeholder}
    aria-label="Buscar palabra"
    class="text-theme flex-1 border-none bg-transparent text-base outline-none placeholder:opacity-50"
  />
  <button
    class="search-btn relative cursor-pointer overflow-hidden rounded-md border-none px-4 py-2.5 font-semibold text-white transition-all duration-200 active:scale-95"
    type="submit"
    aria-label="Buscar"
  >
    <span class="relative z-10 flex items-center gap-2 text-white">
      <svg
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2.5"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <span class="hidden md:inline"> Buscar </span>
    </span>
  </button>
</form>

<style>
  .search-btn {
    position: relative;
    background: var(--btn-primary-bg);
    box-shadow:
      0 2px 8px var(--btn-primary-shadow),
      0 1px 3px var(--shadow-md);
  }

  .search-btn:hover {
    box-shadow:
      0 4px 12px var(--btn-primary-shadow),
      0 2px 6px var(--shadow-md);
    transform: translateY(-1px);
  }

  .search-btn:active {
    box-shadow: 0 1px 4px var(--btn-primary-shadow);
    transform: translateY(0) scale(0.95);
  }

  .search-btn:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }
</style>

<script>
  document.addEventListener("keydown", (e) => {
    if (e.key === "/" && !(e.target instanceof HTMLInputElement)) {
      e.preventDefault();
      const input = document.querySelector('input[type="search"]') as HTMLInputElement;
      input?.focus();
    }
  });
</script>
