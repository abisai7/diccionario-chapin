---
import { getLangFromUrl, useTranslations } from "../utils/i18n";
import Logo from "./icons/Logo.astro";
import LanguageSwitcher from "./LanguageSwitcher.astro";
import Navigation from "./Navigation.astro";
import MobileMenu from "./MobileMenu.astro";
import ThemeToggle from "./ThemeToggle.astro";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const prefix = lang === "en" ? "/en" : "/es";
---

<header class="relative mx-auto max-w-[1100px] px-4 py-4 sm:px-6" transition:persist>
  <div class="flex items-center justify-between gap-4">
    <!-- Logo y título -->
    <a
      href={`${prefix}/`}
      class="flex shrink-0 items-center gap-2 text-base font-bold sm:gap-2.5 sm:text-lg"
      aria-label="Ir a la página principal"
      data-umami-event="Logo Click"
      data-umami-event-location="header"
    >
      <Logo height={75} />
    </a>

    <!-- Navegación y controles desktop -->
    <nav class="hidden items-center gap-2 md:flex">
      <Navigation />
      <LanguageSwitcher />
      <ThemeToggle />
    </nav>

    <!-- Controles móviles -->
    <div class="flex items-center gap-2 md:hidden">
      <LanguageSwitcher />
      <ThemeToggle isMobile={true} />
      <MobileMenu />
    </div>

    <style>
      @media (min-width: 480px) {
        .xs\:inline {
          display: inline;
        }
      }

      .gt-badge-flag {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .gt-badge-flag svg {
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.15));
      }

      .gt-badge-flag .flag-path {
        fill: url(#guatemalaFlag);
      }

      .gt-badge-flag:hover svg {
        transform: scale(1.05);
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
      }

      [data-theme="dark"] .gt-badge-flag .flag-path {
        fill: url(#guatemalaFlagDark);
      }

      [data-theme="dark"] .gt-badge-flag svg {
        filter: drop-shadow(0 2px 3px rgba(73, 151, 208, 0.4));
      }

      [data-theme="dark"] .gt-badge-flag:hover svg {
        filter: drop-shadow(0 3px 6px rgba(73, 151, 208, 0.5));
      }
    </style>
  </div>
</header>
