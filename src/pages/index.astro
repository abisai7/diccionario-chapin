---
export const prerender = true;

import Base from "../layouts/Base.astro";
import SearchBox from "../components/SearchBox.astro";
import Ticker from "../components/Ticker.astro";
import { getCollection } from "astro:content";
import WordCard from "../components/WordCard.astro";

const allWords = await getCollection("words");
const wordList = allWords.map((w) => w.data.word);
const shuffled = [...wordList].sort(() => Math.random() - 0.5);
const featured = shuffled.slice(0, Math.min(45, shuffled.length));
const top = allWords.slice(0, 6);
---

<Base title="Diccionario Chapín">
  <section class="mx-auto max-w-[1100px]">
    <div
      class="m-6 grid gap-3.5 backdrop-blur-sm"
      style="
      border: 1px solid var(--border); 
      border-radius: var(--radius-xl); 
      background: linear-gradient(180deg, var(--card) 0%, var(--bg-accent) 100%);
      box-shadow: 0 4px 12px var(--shadow-md);
    "
    >
      <h1
        class="mx-4 mt-4 bg-linear-to-r bg-clip-text text-[clamp(1.8rem,2.4vw,2.6rem)] font-bold text-transparent"
        style="background-image: linear-gradient(to right, var(--text), var(--primary-light))"
      >
        Diccionario Chapín
      </h1>
      <p class="mx-4 text-base" style="color: var(--muted)">
        Palabras chapinas con significado y ejemplos.
      </p>
      <div class="mx-4 grid grid-cols-1">
        <SearchBox placeholder="Buscar 'patojo', 'chilero'..." />
      </div>
      <div
        class="mx-4 mb-4 px-3 py-2 text-sm backdrop-blur-sm"
        style="border: 1px solid var(--border); border-radius: var(--radius-md); background: var(--glow-primary); color: var(--muted)"
      >
        <span class="inline-flex items-center gap-2">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 16v-4M12 8h.01"></path>
          </svg>
          Sugerencia: presiona <kbd
            class="mx-1 px-2 py-0.5 font-mono text-xs"
            style="background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-sm); color: var(--text)"
            >/</kbd
          > para enfocar el buscador.
        </span>
      </div>
    </div>
  </section>

  <section class="mx-auto max-w-[1100px] px-6">
    <Ticker words={featured} />
  </section>

  <section class="mx-auto max-w-[1100px] px-6">
    <h2 class="m-0 mb-2.5 text-2xl font-bold">Destacadas</h2>
    <div class="mt-4 grid grid-cols-[repeat(auto-fill,minmax(260px,1fr))] gap-3.5">
      {
        top.map((item) => (
          <WordCard word={item.data.word} meaning={item.data.meaning} slug={item.slug} />
        ))
      }
    </div>
  </section>

  <script is:inline>
    document.addEventListener("keydown", (e) => {
      if (e.key === "/" && !(e.target instanceof HTMLInputElement)) {
        e.preventDefault();
        const input = document.querySelector('input[type="search"]');
        input?.focus();
      }
    });
  </script>
</Base>
