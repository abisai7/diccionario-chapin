---
export const prerender = true;

import Base from "../layouts/Base.astro";
import { getCollection } from "astro:content";

const allWords = await getCollection("words");
const sorted = allWords.sort((a, b) => a.data.word.localeCompare(b.data.word));

// Agrupar palabras por letra inicial
const groupedByLetter = sorted.reduce(
  (acc, entry) => {
    const firstLetter = entry.data.word.charAt(0).toUpperCase();
    if (!acc[firstLetter]) {
      acc[firstLetter] = [];
    }
    acc[firstLetter].push(entry);
    return acc;
  },
  {} as Record<string, typeof allWords>
);

// Ordenar las letras
const letters = Object.keys(groupedByLetter).sort();
---

<Base
  title="Índice Alfabético — Diccionario Chapín"
  description="Índice alfabético completo de chapinismos y guatemaltequismos. Navega por todas las palabras organizadas de la A a la Z."
  keywords="índice chapinismos, lista palabras chapinas, glosario guatemalteco alfabético"
>
  <section class="mx-auto max-w-[1100px] px-6">
    <h1 class="mb-4 text-3xl">Índice Alfabético</h1>

    <!-- Navegación de letras -->
    <div
      class="mb-4 flex flex-wrap gap-2 p-4"
      style="background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-lg); box-shadow: 0 1px 2px var(--shadow-sm)"
    >
      {
        letters.map((letter) => (
          <a
            href={`#letra-${letter}`}
            class="px-3 py-1.5 text-sm font-semibold transition-all duration-200"
            style="background: var(--glow-primary); color: var(--primary); border: 1px solid var(--border); border-radius: var(--radius-md); &:hover { background: var(--card-hover) }"
          >
            {letter}
          </a>
        ))
      }
    </div>

    {/* Palabras agrupadas por letra */}
    <div class="space-y-6">
      {
        letters.map((letter) => (
          <div
            id={`letra-${letter}`}
            class="p-6"
            style="background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-xl); box-shadow: 0 2px 8px var(--shadow-md)"
          >
            {/* Letra grande como divisor */}
            <div
              class="mb-4 flex items-center gap-4 pb-3"
              style="border-bottom: 2px solid var(--primary)"
            >
              <h2 class="font-title text-primary m-0 text-5xl font-bold" style="line-height: 1;">
                {letter}
              </h2>
              <span class="text-sm font-medium" style="color: var(--muted)">
                {groupedByLetter[letter].length && groupedByLetter[letter].length > 1
                  ? `${groupedByLetter[letter].length} palabras`
                  : `${groupedByLetter[letter].length} palabra`}
              </span>
            </div>

            {/* Lista de palabras para esta letra */}
            <ul class="m-0 list-none columns-2 gap-6 p-0">
              {groupedByLetter[letter].map((w) => (
                <li class="break-inside-avoid py-1.5">
                  <a
                    href={`/palabras/${w.slug}`}
                    class="inline-flex items-center gap-2 transition-transform duration-200 hover:translate-x-1"
                    style="color: var(--text)"
                  >
                    <svg
                      width="12"
                      height="12"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      style="color: var(--primary); opacity: 0.6"
                    >
                      <circle cx="12" cy="12" r="2" />
                    </svg>
                    {w.data.word}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ))
      }
    </div>
  </section>
</Base>

<style>
  /* Scroll suave para la navegación de letras */
  html {
    scroll-behavior: smooth;
  }

  /* Ajuste para el offset del scroll */
  [id^="letra-"] {
    scroll-margin-top: 20px;
  }
</style>
