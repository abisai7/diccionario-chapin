---
export const prerender = true;

import Base from "../../layouts/Base.astro";
import Ticker from "../../components/Ticker.astro";
import HeroSection from "../../components/home/HeroSection.astro";
import FeaturedWords from "../../components/home/FeaturedWords.astro";
import ContributeSection from "../../components/home/ContributeSection.astro";
import { getCollection } from "astro:content";
import { useTranslations } from "../../utils/i18n";

export async function getStaticPaths() {
  return [{ params: { lang: "es" } }, { params: { lang: "en" } }];
}

const { lang } = Astro.params;
const t = useTranslations(lang);

const collectionName = lang === "es" ? "words-es" : "words-en";
const allWords = await getCollection(collectionName);
const wordList = allWords.map((w) => w.data.word);
const shuffled = [...wordList].sort(() => Math.random() - 0.5);
const featured = shuffled.slice(0, Math.min(45, shuffled.length));

// Get featured words or fallback to random if none are marked
const featuredWords = allWords.filter((w) => w.data.featured === true);
const top =
  featuredWords.length >= 6
    ? featuredWords.slice(0, 6)
    : [...allWords].sort(() => Math.random() - 0.5).slice(0, 6);
---

<Base title={t("home.title")} description={t("home.description")} keywords={t("home.keywords")}>
  <HeroSection lang={lang} />

  <section class="mx-auto max-w-[1100px] px-6">
    <Ticker words={featured} lang={lang} />
  </section>

  <FeaturedWords words={top} lang={lang} />

  <ContributeSection lang={lang} />
</Base>
