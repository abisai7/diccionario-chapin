---
export const prerender = true;

import Base from "../../layouts/Base.astro";
import { getCollection } from "astro:content";
import { useTranslations } from "../../utils/i18n";

export async function getStaticPaths() {
  return [{ params: { lang: "es" } }, { params: { lang: "en" } }];
}

const { lang } = Astro.params;
const t = useTranslations(lang);

const collectionName = lang === "es" ? "words-es" : "words-en";
const allWords = await getCollection(collectionName);
const sortedWords = [...allWords].sort((a, b) => a.data.word.localeCompare(b.data.word, "es"));

// Group by first letter
const grouped = sortedWords.reduce((acc, item) => {
  const firstLetter = item.data.word[0].toUpperCase();
  if (!acc[firstLetter]) acc[firstLetter] = [];
  acc[firstLetter].push(item);
  return acc;
}, {});

const letters = Object.keys(grouped).sort();
---

<Base
  title={t("index.title") +
    " — " +
    (lang === "es" ? "Diccionario Chapín" : "Guatemalan Dictionary")}
  description={t("index.description")}
  keywords={lang === "es"
    ? "índice chapinismos, lista palabras chapinas, alfabético diccionario chapín"
    : "guatemalan slang index, guatemalan words list, alphabetical guatemalan dictionary"}
>
  <div class="mx-auto max-w-[1100px] px-6">
    <div class="card-with-gradient shadow-theme-lg my-6 grid gap-3.5 backdrop-blur-sm">
      <h1
        class="gradient-text mx-4 mt-4 bg-linear-to-r bg-clip-text text-[clamp(1.8rem,2.4vw,2.6rem)] text-transparent"
      >
        {t("index.title")}
      </h1>
      <p class="text-muted mx-4 mb-4 text-base">
        {t("index.subtitle", { count: allWords.length })}
      </p>
    </div>

    <!-- Letter navigation -->
    <div
      class="border-theme bg-card/85 shadow-theme-sm sticky top-[72px] z-10 mb-6 flex flex-wrap gap-2 rounded-lg border p-4 backdrop-blur-md"
    >
      {
        letters.map((letter) => (
          <a
            href={`#${letter}`}
            class="border-theme bg-accent text-theme hover:bg-primary-light flex h-10 w-10 items-center justify-center rounded-md border font-semibold transition-all hover:scale-110 hover:text-white"
            data-umami-event="Index Letter Jump"
            data-umami-event-letter={letter}
          >
            {letter}
          </a>
        ))
      }
    </div>

    <!-- Words grouped by letter -->
    <div class="space-y-8 pb-12">
      {
        letters.map((letter) => (
          <section id={letter} class="scroll-mt-32">
            <h2 class="text-primary-light mb-4 flex items-center gap-3 text-4xl font-bold">
              <span
                class="shadow-theme-md flex h-14 w-14 items-center justify-center rounded-lg text-white"
                style="background: linear-gradient(135deg, var(--primary-light), var(--primary));"
              >
                {letter}
              </span>
              <span class="text-muted text-sm font-normal">
                {grouped[letter].length}{" "}
                {grouped[letter].length === 1
                  ? lang === "es"
                    ? "palabra"
                    : "word"
                  : lang === "es"
                    ? "palabras"
                    : "words"}
              </span>
            </h2>
            <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
              {grouped[letter].map((item) => {
                const prefix = lang === "es" ? "/es" : "/en";
                return (
                  <a
                    href={`${prefix}/palabras/${item.slug}`}
                    class="group border-theme bg-card shadow-theme-sm hover:shadow-theme-md hover:border-primary-light block rounded-lg border p-4 transition-all hover:-translate-y-0.5"
                    data-umami-event="Index Word Click"
                    data-umami-event-word={item.data.word}
                    data-umami-event-letter={letter}
                  >
                    <h3 class="text-theme mb-2 text-xl font-semibold transition-colors">
                      {item.data.word}
                    </h3>
                    <p class="text-secondary text-sm leading-relaxed">{item.data.meaning}</p>
                    <div class="mt-3 flex items-center gap-2">
                      <span class="bg-glow-primary text-primary-light border-theme rounded-md border px-2 py-1 text-xs font-medium">
                        {item.data.category}
                      </span>
                      <svg
                        class="text-muted ml-auto transition-transform group-hover:translate-x-1"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path d="M5 12h14M12 5l7 7-7 7" />
                      </svg>
                    </div>
                  </a>
                );
              })}
            </div>
          </section>
        ))
      }
    </div>
  </div>

  <style>
    .scroll-mt-32 {
      scroll-margin-top: 8rem;
    }
  </style>
</Base>
