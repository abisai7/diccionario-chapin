---
export const prerender = true;

import Base from "../../layouts/Base.astro";
import { getCollection } from "astro:content";
import { useTranslations } from "../../utils/i18n";

export async function getStaticPaths() {
  return [{ params: { lang: "es" } }, { params: { lang: "en" } }];
}

const { lang } = Astro.params;
const t = useTranslations(lang);

const collectionName = lang === "es" ? "words-es" : "words-en";
const allWords = await getCollection(collectionName);
const sortedWords = [...allWords].sort((a, b) => a.data.word.localeCompare(b.data.word, "es"));

// Group by first letter
const grouped = sortedWords.reduce((acc, item) => {
  const firstLetter = item.data.word[0].toUpperCase();
  if (!acc[firstLetter]) acc[firstLetter] = [];
  acc[firstLetter].push(item);
  return acc;
}, {});

const letters = Object.keys(grouped).sort();
---

<Base
  title={t("index.title") +
    " — " +
    (lang === "es" ? "Diccionario Chapín" : "Guatemalan Dictionary")}
  description={t("index.description")}
  keywords={lang === "es"
    ? "índice chapinismos, lista palabras chapinas, alfabético diccionario chapín"
    : "guatemalan slang index, guatemalan words list, alphabetical guatemalan dictionary"}
>
  <div class="mx-auto max-w-[1100px] px-6">
    <div
      class="my-6 grid gap-3.5 backdrop-blur-sm"
      style="
      border: 1px solid var(--border); 
      border-radius: var(--radius-xl); 
      background: linear-gradient(180deg, var(--card) 0%, var(--bg-accent) 100%);
      box-shadow: 0 4px 12px var(--shadow-md);
    "
    >
      <h1
        class="mx-4 mt-4 bg-linear-to-r bg-clip-text text-[clamp(1.8rem,2.4vw,2.6rem)] text-transparent"
        style="background-image: linear-gradient(to right, var(--text), var(--primary-light))"
      >
        {t("index.title")}
      </h1>
      <p class="mx-4 mb-4 text-base" style="color: var(--muted)">
        {t("index.subtitle", { count: allWords.length })}
      </p>
    </div>

    <!-- Letter navigation -->
    <div
      class="sticky top-[72px] z-10 mb-6 flex flex-wrap gap-2 rounded-lg border p-4 backdrop-blur-md"
      style="
        border: 1px solid var(--border); 
        background: rgba(var(--card-rgb), 0.85);
        box-shadow: 0 2px 8px var(--shadow-sm);
      "
    >
      {
        letters.map((letter) => (
          <a
            href={`#${letter}`}
            class="flex h-10 w-10 items-center justify-center rounded-md font-semibold transition-all"
            style="
              border: 1px solid var(--border);
              background: var(--bg-accent);
              color: var(--text);
            "
            onmouseover="this.style.background='var(--primary-light)'; this.style.color='white'; this.style.transform='scale(1.1)';"
            onmouseout="this.style.background='var(--bg-accent)'; this.style.color='var(--text)'; this.style.transform='scale(1)';"
          >
            {letter}
          </a>
        ))
      }
    </div>

    <!-- Words grouped by letter -->
    <div class="space-y-8 pb-12">
      {
        letters.map((letter) => (
          <section id={letter} class="scroll-mt-32">
            <h2
              class="mb-4 flex items-center gap-3 text-4xl font-bold"
              style="color: var(--primary-light)"
            >
              <span
                class="flex h-14 w-14 items-center justify-center rounded-lg"
                style="
                  background: linear-gradient(135deg, var(--primary-light), var(--primary));
                  color: white;
                  box-shadow: 0 4px 12px var(--shadow-md);
                "
              >
                {letter}
              </span>
              <span class="text-sm font-normal" style="color: var(--muted)">
                {grouped[letter].length}{" "}
                {grouped[letter].length === 1
                  ? lang === "es"
                    ? "palabra"
                    : "word"
                  : lang === "es"
                    ? "palabras"
                    : "words"}
              </span>
            </h2>
            <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
              {grouped[letter].map((item) => {
                const prefix = lang === "es" ? "/es" : "/en";
                return (
                  <a
                    href={`${prefix}/palabras/${item.slug}`}
                    class="group block rounded-lg border p-4 transition-all"
                    style="
                      border: 1px solid var(--border);
                      background: var(--card);
                      box-shadow: 0 1px 3px var(--shadow-sm);
                    "
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px var(--shadow-md)'; this.style.borderColor='var(--primary-light)';"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 3px var(--shadow-sm)'; this.style.borderColor='var(--border)';"
                  >
                    <h3
                      class="mb-2 text-xl font-semibold transition-colors"
                      style="color: var(--text)"
                    >
                      {item.data.word}
                    </h3>
                    <p class="text-sm leading-relaxed" style="color: var(--text-secondary)">
                      {item.data.meaning}
                    </p>
                    <div class="mt-3 flex items-center gap-2">
                      <span
                        class="rounded-md px-2 py-1 text-xs font-medium"
                        style="
                          background: var(--glow-primary);
                          color: var(--primary-light);
                          border: 1px solid var(--border);
                        "
                      >
                        {item.data.category}
                      </span>
                      <svg
                        class="ml-auto transition-transform group-hover:translate-x-1"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        style="color: var(--muted)"
                      >
                        <path d="M5 12h14M12 5l7 7-7 7" />
                      </svg>
                    </div>
                  </a>
                );
              })}
            </div>
          </section>
        ))
      }
    </div>
  </div>

  <style>
    .scroll-mt-32 {
      scroll-margin-top: 8rem;
    }
  </style>
</Base>
